# IN VC Listing

## Плагин WordPress, формирующий список ветеринарных клиник
Плагин реализует функциональность для определенного сайта.
Этот плагин не претендует на глобальное распространение.

## Структура URL и шаблоны

### Клиники
Отображение списка клиник. 
Все клиники отображаются в URL ```/clinic/```, например:  
/**clinic**/my-clinic/ -- где _my-clinic_ слаг конкретной клиники.

При обращении к URL ```/clinic/``` обображается все клиники.

Для кастомизации отображегния создайте шаблоны в теме со следующими названиями:
* **single-in-vc-listing.php** -- отображение одной клиники.
* **archive-in-vc-listing.php** -- отображение списка клиник.

### Регионы
Отображение списка клиник в регионе. 
Клиники отображаются в URL ```/clinic/region/```, например:  
/clinic/**region**/my-region/ -- где _my-region_ слаг конкретного региона.

Для кастомизации отображегния создайте шаблоны в теме со следующими названиями:
* **taxonomy-in-vc-region.php** -- отображение списка клиник в регионе.

### Теги
Отображение списка клиник, помеченных определенных тегом. 
Клиники отображаются в URL ```/clinic/tag/```, например:  
/clinic/**tag**/my-tag/ -- где _my-tag_ слаг конкретного тега.

Для кастомизации отображегния создайте шаблоны в теме со следующими названиями:
* **taxonomy-in-vc-tag.php** -- отображение списка клиник, помеченных определенных тегом.

### Фильтрация тегов в регионе
Отображение списка клиник, помеченных определенных тегом в определенном регионе. 
Клиники отображаются в URL ```/clinic/filter/```, например:  
/clinic/**filter**/my-region/**tag**/my-tag/ -- где _my-region_ слаг конкретного региона,  _my-tag_ слаг конкретного тега.

Для кастомизации отображегния используется шаблон тегов:
* **taxonomy-in-vc-tag.php** -- отображение списка клиник, помеченных определенных тегом.

## Шаблоны вывода
Вывод (отображение) клиник производится с помощью кастомизируемых (настраиваемых) шаблонов, 
которые находятся в папке templates. Определены следующие шаблоны:
1. **clinic.php** -- Вывод информации о клинике
2. **archive.php** -- Вывод всех клиник списком
3. **region.php** -- Вывод всех клиник по региону
4. **tag.php** -- Вывод всех клиник по метке

### Кастомизация вывода в шаблонах
Есть два способа кастомизации вывода: 
* программный (хуки)
* шаблонный

#### Программный способ кастомизации вывода
В шаблонах определены следующие хуки (действия)
* **in_vc_listing_clinic_before_main** -- вывод дополнительной информации перед шаблоном вывода одной клиники 
* **in_vc_listing_clinic_after_main** -- вывод дополнительной информации после шаблона вывода одной клиники 
* **in_vc_listing_archive_before_entry** -- вывод дополнительной информации перед выводом заголовка одной клиники
* **in_vc_listing_clinic_before_content** -- вывод дополнительной информации перед выводом контента одной клиники
* **in_vc_listing_clinic_after_content** -- вывод дополнительной информации после контента одной клиники

Аналогичные шаблоны определены для остальных трех шаблонов, то есть
```in_vc_listing_ШАБЛОН_ПОЛОЖЕНИЕ_БЛОК```

Кроме того, определены фильтры:
* **in_vc_listing_clinic_show_thumbnail** -- включает вывод изображений клиники в шаблоне clinic
* **in_vc_listing_archive_show_thumbnail** -- включает вывод изображений клиники в шаблоне archive
* **in_vc_listing_region_show_thumbnail** -- включает вывод изображений клиники в шаблоне region
* **in_vc_listing_tag_show_thumbnail** -- включает вывод изображений клиники в шаблоне tag
* **in_vc_listing_clinic_thumbnail_size** -- устанавливает размер изображений клиники в шаблоне clinic
* **in_vc_listing_archive_thumbnail_size** -- устанавливает размер изображений клиники в шаблоне archive
* **in_vc_listing_region_thumbnail_size** -- устанавливает размер изображений клиники в шаблоне region
* **in_vc_listing_tag_thumbnail_size** -- устанавливает размер изображений клиники в шаблоне tag

#### Кастомизация перекрытием шаблона
Для изменения шаблона создайте в своей теме папку ```in-vc-listing``` и скопируйте в нее файл нужного шаблона 
из папки плагина ```templates```. Произвольно изменяйте HTML код в скопированном файле шаблона, 
он будет применен автоматически.

**Важно!** При изменении шаблона _сохраните_ все вызовы do_action()! Они также используется самим плагином! 
Если вы удалите из шаблона эти вызовы, часть функций плагина может не работать.

## Карты Google

### Начало работы
Для вывода карт Google необхоимо получить ключ API. Инструкция по его получению находится 
в статье "[Get an API Key](https://developers.google.com/maps/documentation/embed/get-api-key)".
Выполните все что там написано.

После этого перейдите в раздел Клиники --> Параметры и вставьте в поле полученый ключ API.

### Указание координат клиники 
Для вывода клиники на карту используется географические координаты. Их можно получить с карт Google или Яндекс.
Откройте карточку клиники в админке и указите широту и долготу в формате XX.XXXXXX в соотвествующих полях.
Если вы не хотите, чтобы клиника выводилась на карте, сотрите ее координаты. 
Выводятся только клиники с указанными координатами. 

### Настройка внешнего вида карты
Вы можете настроить внешний вид карты (размер, положение) через CSS с помощью правил для объекта
```#in-vc-listing-map```. Поскольку стили этого объекта определяются в теле страницы, используйте инструкицию !important.

```
#in-vc-listing-map {
	width: 700px !important;
	height: 350px !important;
}
``` 


## FAQ
* **При обращении к списку таксономии (теги, регионы, фильтр) получаю ошибку 404**  
Необходимо обновить постоянные ссылки. Для этого зайдите в админке WordPress "Настройки --> Постоянные ссылки"
и просто нажмите кнопку "Сохранить изменения" даже если вы ничего не меняли.

## Журнал изменений
1.4 (01.08.2019)	Добавлены функции Google карт

1.3 (16.07.2019)	Добавлены шаблоны вывода

1.2 (25.05.2019)	Добавлена фильтрация по тегам внутри региона

1.1 (19.05.2019)	Добавлена таксономия регионов

1.0 (15.05.2019)	Реализация CTP и меток

